<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar - Doações</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    .form-input {
      transition: all 0.3s ease;
    }
    .form-input:focus {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.1);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen flex items-center justify-center">
  <div class="max-w-md w-full mx-auto p-4">
    <!-- Header -->
    <header class="gradient-bg text-white rounded-2xl p-6 mb-8 shadow-xl text-center">
      <a href="/" class="inline-block mb-4 text-blue-100 hover:text-white transition-colors">
        <i class="fas fa-arrow-left mr-2"></i>Voltar ao Início
      </a>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">
        <i class="fas fa-user-plus text-yellow-300 mr-3"></i>Criar Conta
      </h1>
      <p class="text-blue-100">Junte-se à nossa comunidade de doadores</p>
    </header>

    <!-- Formulário -->
    <form id="form-register" class="bg-white rounded-2xl shadow-xl p-8">
      <div class="space-y-6">
        <!-- Nome -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            <i class="fas fa-user text-blue-500 mr-2"></i>Nome Completo *
          </label>
          <input 
            name="name" 
            required 
            class="form-input w-full border-2 border-gray-200 p-4 rounded-xl focus:border-blue-500 focus:outline-none text-lg" 
            placeholder="Seu nome completo"
          />
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            <i class="fas fa-envelope text-green-500 mr-2"></i>Email *
          </label>
          <input 
            name="email" 
            type="email" 
            required 
            class="form-input w-full border-2 border-gray-200 p-4 rounded-xl focus:border-green-500 focus:outline-none text-lg" 
            placeholder="seu@email.com"
          />
        </div>

        <!-- Senha -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            <i class="fas fa-lock text-purple-500 mr-2"></i>Senha *
          </label>
          <input 
            name="password" 
            type="password" 
            required 
            class="form-input w-full border-2 border-gray-200 p-4 rounded-xl focus:border-purple-500 focus:outline-none text-lg" 
            placeholder="Mínimo 6 caracteres"
          />
        </div>

        <!-- Cidade -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Cidade
          </label>
          <input 
            name="city" 
            class="form-input w-full border-2 border-gray-200 p-4 rounded-xl focus:border-red-500 focus:outline-none text-lg" 
            placeholder="Sua cidade"
          />
        </div>

        <!-- Botões -->
        <div class="space-y-4 pt-4">
          <button 
            type="submit" 
            class="btn-primary w-full py-4 px-6 text-white rounded-xl font-semibold text-lg shadow-lg"
          >
            <i class="fas fa-user-plus mr-2"></i>Criar Conta
          </button>
          
          <div class="text-center">
            <p class="text-gray-600">Já tem uma conta?</p>
            <a 
              href="/login.html" 
              class="text-blue-600 hover:text-blue-700 font-semibold transition-colors"
            >
              <i class="fas fa-sign-in-alt mr-1"></i>Fazer login
            </a>
          </div>
        </div>
      </div>
    </form>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-2xl p-8 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
        <p class="text-lg font-semibold text-gray-700">Criando sua conta...</p>
      </div>
    </div>
  </div>

  <script>
    const API = (window.location.hostname === 'localhost') ? 'http://localhost:4000' : 'https://YOUR_BACKEND_URL';
    
    document.getElementById('form-register').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      
      // Mostrar loading
      document.getElementById('loading-overlay').classList.remove('hidden');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Criando...';
      submitBtn.disabled = true;

      try {
        const f = new FormData(form);
        const body = { 
          name: f.get('name'), 
          email: f.get('email'), 
          password: f.get('password'), 
          city: f.get('city') 
        };
        
        const res = await fetch(API + '/register', { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(body) 
        });
        
        const data = await res.json();
        
        if (data.token) {
          localStorage.setItem('token', data.token);
          showNotification('Conta criada com sucesso!', 'success');
          setTimeout(() => {
            window.location.href = '/';
          }, 1500);
        } else {
          showNotification('Erro: ' + (data.error || 'Erro ao criar conta'), 'error');
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
          document.getElementById('loading-overlay').classList.add('hidden');
        }
      } catch (error) {
        showNotification('Erro ao processar registro', 'error');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        document.getElementById('loading-overlay').classList.add('hidden');
      }
    });

    // Função para mostrar notificações
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl shadow-lg transform transition-all duration-300 translate-x-full`;
      
      const colors = {
        success: 'bg-green-500 text-white',
        error: 'bg-red-500 text-white',
        warning: 'bg-yellow-500 text-white',
        info: 'bg-blue-500 text-white'
      };
      
      notification.className += ` ${colors[type]}`;
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-3"></i>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-4 hover:opacity-75">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }
  </script>
</body>
</html>
